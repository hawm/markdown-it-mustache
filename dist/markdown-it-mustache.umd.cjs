(function(f,t){typeof exports=="object"&&typeof module<"u"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):(f=typeof globalThis<"u"?globalThis:f||self,t(f.MarkdownItMustache={}))})(this,function(f){"use strict";const m=[35,94],k=47;function d(e,r,s,o){for(let n=r;n<s;n++)if(!o(e.charCodeAt(n)))return!1;return!0}function g(e,r,s,o=!1){let n,c,i;for(n=r;n<s-5;n++){if(e.charCodeAt(n)===123&&e.charCodeAt(n+1)===123){i=!0;break}if(o||e.charCodeAt(n)===10)return!1}if(!i)return!1;for(c=n+2;c<=s;c++)if(e.charCodeAt(c-1)==125&&e.charCodeAt(c)==125)return{start:n,end:c};return!1}function a(e,r,s,o=!1){const n=g(e,r,s,o);if(!n)return!1;const c=e.slice(n.start,n.end+1),i=c.slice(2,-2),u=m.includes(i.charCodeAt(0)),l=i.charCodeAt(0)===k,p=u?1:l?-1:0,h=i.slice(Math.abs(p));return{opening:u,closing:l,nesting:p,name:h,raw:c,pos:n}}function M(e,r,s,o){let n,c,i,u,l=0;for(i=s;i<=o&&(n=e.bMarks[i]+e.tShift[i],c=e.eMarks[i],!(n<c&&e.sCount[i]<e.blkIndent));i++)if(!(e.sCount[i]-e.blkIndent>=4)&&(u=a(e.src,n,c,!0),!!u&&d(e.src,u.pos.end+1,e.eMarks[i],e.md.utils.isWhiteSpace)))if(u.closing&&u.name===r.name){if(l===0){u.line=i,u.block=!0;break}l--}else u.opening&&u.name===r.name&&l++;return u}function b(e,r,s,o){const n=e.bMarks[r]+e.tShift[r],c=e.eMarks[r],i=a(e.src,n,c,!0);if(!i||!i.opening||!d(e.src,i.pos.end+1,c,e.md.utils.isWhiteSpace))return!1;const u=M(e,i,r+1,s);if(!u)return!1;if(!o){const l=e.push("mustache_open","div",1);l.map=[r,u.line];const p=e.parentType,h=e.lineMax;e.parentType="mustache_block",e.lineMax=u.line,e.md.block.tokenize(e,r+1,u.line),e.parentType=p,e.lineMax=h,e.push("mustache_close","div",-1)}return e.line=u.line+1,!0}function C(e){e.block.ruler.after("fence","mustache-block",b,{alt:["paragraph","reference","blockquote","list"]})}function _(e,r,s,o){let n,c=0;for(let i=s;i<o-5;){if(n=a(e,i,o),!n)return!1;if(n.closing&&n.name===r.name){if(c===0)break;c--}else n.opening&&n.name===r.name&&c++;i=n.pos.end+1}return n}function T(e,r){let s;const o=a(e.src,e.pos,e.posMax);if(!o)return!1;if(o.nesting===0)return r||(s=e.push("mustache_inline","span",0),s.meta={tag:o}),e.pos=o.pos.end+1,!0;if(o.closing)return r||(s=e.push("mustache_inline","span",0),s.meta={tag:o}),e.pos=o.pos.end+1,!0;const n=_(e.src,o,o.pos.end+1,e.posMax);return n?(r||(e.push("mustache_open","span",1),e.pos=o.pos.end+1,e.posMax=n.pos.start,e.md.inline.tokenize(e),e.posMax=e.src.length,e.push("mustache_close","span",-1)),e.pos=n.pos.end+1,!0):(r||(s=e.push("mustache_inline","span",0),s.meta={tag:o}),e.pos=o.pos.end+1,!0)}function x(e,r,s,o,n){return`<span>${e[r].meta.tag.raw}</span>`}function y(e){e.inline.ruler.push("mustache-inline",T),e.renderer.rules.mustache_inline=x}f.mustacheBlock=C,f.mustacheInline=y,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
