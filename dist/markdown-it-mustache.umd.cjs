(function(u,m){typeof exports=="object"&&typeof module<"u"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(u=typeof globalThis<"u"?globalThis:u||self,m(u.MarkdownItMustache={}))})(this,function(u){"use strict";const k=[35,94],g=47,b=[33,38,62];function d(e,o,c,a){for(let n=o;n<c;n++)if(!a(e.charCodeAt(n)))return!1;return!0}function C(e,o,c,a=!1){let n,r,s;for(n=o;n<c-5;n++){if(e.charCodeAt(n)===123&&e.charCodeAt(n+1)===123){s=!0;break}if(a||e.charCodeAt(n)===10)return!1}if(!s)return!1;for(r=n+2;r<=c;r++)if(e.charCodeAt(r-1)==125&&e.charCodeAt(r)==125)return{start:n,end:r};return!1}function h(e,o,c,a=!1){const n=C(e,o,c,a);if(!n)return!1;const r=e.slice(n.start,n.end+1),s=r.slice(2,-2),i=s.charCodeAt(0),t=k.includes(i),f=t?!1:i===g,l=t?1:f?-1:0,p=s.slice(l?1:0).trim(),I=l!==0||b.includes(i)?String.fromCharCode(i):"";return{opening:t,closing:f,nesting:l,mark:I,name:p,content:s,raw:r,pos:n}}function M(e,o,c,a){let n,r,s,i,t=0;for(s=c;s<=a&&(n=e.bMarks[s]+e.tShift[s],r=e.eMarks[s],!(n<r&&e.sCount[s]<e.blkIndent));s++)if(!(e.sCount[s]-e.blkIndent>=4)&&(i=h(e.src,n,r,!0),!!i&&d(e.src,i.pos.end+1,e.eMarks[s],e.md.utils.isWhiteSpace)))if(i.closing&&i.name===o.name){if(t===0){i.line=s,i.block=!0;break}t--}else i.opening&&i.name===o.name&&t++;return i}function _(e,o,c,a){const n=e.bMarks[o]+e.tShift[o],r=e.eMarks[o],s=h(e.src,n,r,!0);if(!s||!s.opening||!d(e.src,s.pos.end+1,r,e.md.utils.isWhiteSpace))return!1;const i=M(e,s,o+1,c);if(!i)return!1;if(!a){const t=e.push("mustache_block","div",1);t.block=!0,t.meta={tag:s},t.map=[o,i.line],t.attrs=[["class","mustache mustache-block"],["data-mustache-name",s.name],["data-mustache-mark",s.mark]];const f=e.parentType,l=e.lineMax;e.parentType="mustache_block",e.lineMax=i.line,e.md.block.tokenize(e,o+1,i.line),e.parentType=f,e.lineMax=l;const p=e.push("mustache_block","div",-1);p.block=!0,p.meta={tag:i}}return e.line=i.line+1,!0}function T(e){e.block.ruler.after("fence","mustache_block",_,{alt:["paragraph","reference","blockquote","list"]})}function x(e,o,c,a){let n,r=0;for(let s=c;s<a-5;s=n.pos.end+1){if(n=h(e,s,a),!n)return!1;if(n.closing&&n.name===o.name){if(r===0)return n;r--}else n.opening&&n.name===o.name&&r++}return!1}function y(e,o){let c;if(e.src.charCodeAt(e.pos)!==123)return!1;const a=h(e.src,e.pos,e.posMax);if(!a)return!1;if(a.nesting===0)return o||(c=e.push("mustache_inline","span",0),c.meta={tag:a},c.attrs=[["class","mustache mustache-inline"],["data-mustache-name",a.name],["data-mustache-mark",a.mark]]),e.pos=a.pos.end+1,!0;if(a.closing)return o||(c=e.push("mustache_invalid","span",0),c.meta={tag:a},c.attrs=[["class","mustache mustache-inline mustache-invalid"],["data-mustache-name",a.name],["data-mustache-mark",a.mark],["data-mustache-msg","missing open tag"]]),e.pos=a.pos.end+1,!0;const n=x(e.src,a,a.pos.end+1,e.posMax);return n?(o||(c=e.push("mustache_inline_block","span",1),c.meta={tag:a},c.attrs=[["class","mustache mustache-inline mustache-inline-block"],["data-mustache-name",a.name],["data-mustache-mark",a.mark]],e.pos=a.pos.end+1,e.posMax=n.pos.start,e.md.inline.tokenize(e),e.pos=n.pos.end+1,e.posMax=e.src.length,c=e.push("mustache_inline_block","span",-1),c.meta={tag:n}),e.pos=n.pos.end+1,!0):(o||(c=e.push("mustache_invalid","span",0),c.meta={tag:a},c.content=n.raw,c.attrs=[["class","mustache mustache-inline mustache-invalid"],["data-mustache-name",a.name],["data-mustache-mark",a.mark],["data-mustache-msg","missing close tag"]]),e.pos=a.pos.end+1,!0)}function A(e){e.inline.ruler.push("mustache_inline",y)}u.mustacheBlock=T,u.mustacheInline=A,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
